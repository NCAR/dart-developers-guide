<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Workflows - DART Developer&#x27;s Guide</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Welcome</a></li><li class="chapter-item expanded "><a href="dart-flow.html"><strong aria-hidden="true">1.</strong> DART flow</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="feature-branch.html"><strong aria-hidden="true">1.1.</strong> Feature Branch Workflow</a></li><li class="chapter-item expanded "><a href="git-setup.html"><strong aria-hidden="true">1.2.</strong> Using git</a></li><li class="chapter-item expanded "><a href="create-branch.html"><strong aria-hidden="true">1.3.</strong> Creating a feature branch</a></li><li class="chapter-item expanded "><a href="commit-messages.html"><strong aria-hidden="true">1.4.</strong> Committing your code</a></li><li class="chapter-item expanded "><a href="private.html"><strong aria-hidden="true">1.5.</strong> Public vs. Private development</a></li></ol></li><li class="chapter-item expanded "><a href="example-spec.html"><strong aria-hidden="true">2.</strong> Writing Specifications</a></li><li class="chapter-item expanded "><a href="github.html"><strong aria-hidden="true">3.</strong> Github</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="issues.html"><strong aria-hidden="true">3.1.</strong> Tracking tasks</a></li><li class="chapter-item expanded "><a href="bug-reports.html"><strong aria-hidden="true">3.2.</strong> Reporting bugs</a></li><li class="chapter-item expanded "><a href="reviewing.html"><strong aria-hidden="true">3.3.</strong> Pull Requests</a></li><li class="chapter-item expanded "><a href="releases.html"><strong aria-hidden="true">3.4.</strong> Creating a Release</a></li></ol></li><li class="chapter-item expanded "><a href="github-actions.html"><strong aria-hidden="true">4.</strong> Github Actions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="github-actions-workflow.html" class="active"><strong aria-hidden="true">4.1.</strong> Workflows</a></li><li class="chapter-item expanded "><a href="github-actions-composites.html"><strong aria-hidden="true">4.2.</strong> Composite Actions</a></li></ol></li><li class="chapter-item expanded "><a href="ideal-rotary-phone.html"><strong aria-hidden="true">5.</strong> Github Playground</a></li><li class="chapter-item expanded "><a href="web-and-docs.html"><strong aria-hidden="true">6.</strong> DART web presence</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="documentation.html"><strong aria-hidden="true">6.1.</strong> Documentation</a></li><li class="chapter-item expanded "><a href="website.html"><strong aria-hidden="true">6.2.</strong> DART website</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Draft: Style Guide</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Draft: DART</div></li><li class="chapter-item expanded affix "><a href="contributors.html">Contributors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">DART Developer&#x27;s Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/NCAR/dart-developers-guide" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="workflows"><a class="header" href="#workflows">Workflows</a></h1>
<p>Workflows are the configured pipelines that automatically run depending on triggers specified for a workflow. Configuration of a Github Actions workflow is done in a <code>YAML</code> file containing key-value pairs. Keys are the labels that the Github Action <a href="#jump-runner">runners</a> interpret, and the values are arguments for the specific labels.</p>
<p>Example Github Actions <code>YAML</code> file:</p>
<pre><code class="language-yaml">name: Example Github Actions YAML Structure
run-name: ${{ github.actor }} triggered workflow via Push

on: push                                     # trigger workflow on Push to repo

jobs:
  echo-hello-world:                          # name of current workflow job
    runs-on: ubuntu-latest                   # choose operation system for workflow to run on
    steps:
      - name: Echo 'Hello World!' to shell   # Divide instruction sets by categories or 'names'
        run: echo 'Hello World!'             # 'run' label executes the paired value in the runner shell
</code></pre>
<p>Workflow <code>YAML</code> files must be placed inside the repository's <code>.github/workflows/</code> directory.
Results and logs of your workflows are located in the <a href="https://github.com/NCAR/DART/actions">'Actions' tab</a> of your Github Repository.</p>
<p>This document only aims to give a brief overview of Github Action Workflows. Further documentation can be officially found <a href="https://docs.github.com/en/actions/using-workflows/about-workflows">here</a>.</p>
<p>The following sections will refer to DART's <code>action_on_pull_request.yml</code> workflow, which can be view <a href="https://github.com/NCAR/DART/tree/main/.github/workflows">here</a>. This workflow builds and runs two models in a container that is loaded onto the Github Runner instance.</p>
<h2 id="workflow-triggers"><a class="header" href="#workflow-triggers">Workflow Triggers</a></h2>
<p>Github Actions contains many possible triggers for starting your workflows. Many of which contain additional configuration options for more precise triggers. </p>
<p>Example trigger events to start your workflow include:</p>
<ul>
<li>on push</li>
<li>on pull requests
<ul>
<li>opening/closing</li>
<li>subsequent commits to pull requests</li>
<li>ready_for_review</li>
</ul>
</li>
<li>on issues
<ul>
<li>new issue creation</li>
<li>comment added to an issue</li>
<li>closing of an issue</li>
</ul>
</li>
<li>on fork</li>
<li>etc...</li>
</ul>
<p>For DART's <code>action_on_pull_request.yml</code> workflow, as seen the following lines:</p>
<pre><code class="language-yaml">on:
  pull_request:
    types: [ opened, reopened, synchronize, ready_for_review ]
</code></pre>
<p>is triggered upon the creation and reopening of any pull requests inside the repo. Additionally, the <code>synchronize</code> type specifies that the workflow should be triggered for any subsequent commits made to the pull request branch.</p>
<p>More event trigger options can be found <a href="https://docs.github.com/en/actions/using-workflows/triggering-a-workflow">here</a>.</p>
<p><a name="jump-runner"></a></p>
<h2 id="workflow-runners"><a class="header" href="#workflow-runners">Workflow Runners</a></h2>
<p>Github Actions refers to the virtual machines that your workflows run on top of as runners. These are hosted by Github and their availability depends on the repo's organization tier. Each <a href="#jump-jobs">workflow job</a> must specify their runner instance type.</p>
<p>Specific types of runners is specified by the <code>runs-on:</code> key and can be chosen from this list of <a href="https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#supported-runners-and-hardware-resources">runner instances</a>.</p>
<p>For DART's <code>action_on_pull_request.yml</code> workflow, </p>
<pre><code class="language-yaml">runs-on: ubuntu-latest                  # runner type
    container:                          # specifies a container to run on top of runner
      image: hkershaw/dart-dep:1.0      # uses dart-dep:1.0 container that is pulled from Dockerhub
      options: &quot;--cap-add=SYS_PTRACE&quot;   # nasty argument required for OpenMPI to work correctly in containers
</code></pre>
<p>the instance chosen is <code>ubuntu-latest</code> which loads an Ubuntu operating system on into your runner. The hardware specifications of runner instances can be found <a href="https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#supported-runners-and-hardware-resources">here</a>. At the time of writing, Linux-based runners have:</p>
<ul>
<li>2 x84_64 CPU cores</li>
<li>7 GB of RAM</li>
<li>14 GB of local scratch storage</li>
</ul>
<p>The pull request workflow also loads pre-built Docker container that is hosted on Dockerhub. The usage of a container here is for the portability of the libraries that DART depend on. The recipes for DART Docker containers are hosted in the repo here: https://github.com/NCAR/DART-containers, while the pre-built container image is hosted and pulled from the Dockerhub repository <code>hkershaw/dart-dep:1.0</code>.</p>
<p><a name="jump-jobs"></a></p>
<h2 id="workflow-jobs"><a class="header" href="#workflow-jobs">Workflow Jobs</a></h2>
<p>Workflow jobs are the specific sets of tasks that can be configured to run on your workflow. Multiple jobs with potentially different runner instance types can be configured to run in your workflow.</p>
<blockquote>
<p>Important to note that multiple jobs are run parallelly on <strong>separate</strong> runner instances. One job cannot see the details of another job, however, job dependencies can be configured in your workflow (<a href="https://docs.github.com/en/actions/using-jobs/using-conditions-to-control-job-execution">Using conditions to control job executions</a>).</p>
</blockquote>
<p>Github Actions offer additional design options for running multiple parallel jobs such as <a href="https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs">job matrices</a>.</p>
<h2 id="workflow-testing"><a class="header" href="#workflow-testing">Workflow Testing</a></h2>
<p>When developing a workflow, it is a good idea to create a separate repository for development as to not disturb anyone that follows the main repository. For DART, there exists the following test repository, <a href="https://github.com/NCAR/github-actions-test">https://github.com/NCAR/github-actions-test</a>, to develop and test-run your workflows. </p>
<p>As you develop your workflow, you will notice that for test-runs, there will be a lot (potentially 100s) of commits made to your workflow feature branch. As a result, it is a good idea to rebase and square the commits made before merging into the main branch.</p>
<p>There are open-sourced tools available that help with the development process and even allow for workflows to run locally on your machine for testing:</p>
<ul>
<li><a href="https://github.com/nektos/act">https://github.com/nektos/act</a></li>
</ul>
<h2 id="tidbits"><a class="header" href="#tidbits">Tidbits</a></h2>
<ul>
<li>using a <code>YAML</code> validator available online (<a href="https://jsonformatter.org/yaml-validator">such as this</a>) is instrumental for catching syntactical errors with <code>YAML</code> files</li>
<li>after each <code>run:</code> step, you will be placed back to the top-most directory of the runner and will have to <code>cd</code> back to your working directory if you split your tasks across multiple <code>run:</code> steps.</li>
<li>for every run of a Github Actions workflow, a Github token is generated for the runner instances to use such that it is able to perform tasks such as checking out your repo. For DART, the default permissions of the generated Github token has been set  to read-only, however, it can be changed in a workflow. If your workflow requires additional permissions, consult with someone for if it is necessarily needed. 
<ul>
<li>the following pages are useful for securing your workflow:
<ul>
<li><a href="https://docs.github.com/en/actions/security-guides/automatic-token-authentication">https://docs.github.com/en/actions/security-guides/automatic-token-authentication</a></li>
<li><a href="https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions">https://docs.github.com/en/actions/security-guides/security-hardening-for-github-actions</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="github-actions.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="github-actions-composites.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="github-actions.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="github-actions-composites.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
